{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}My Site{% endblock %}</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/cart.css' %}">

    <style>
        .product-card {
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        .wishlist-icon {
            position: absolute;
            top: 10px;
            right: 12px;
            font-size: 20px;
            color: #dc3545;
        }
        .wishlist-icon:hover {
            color: #a71d2a;
        }
    </style>
</head>

<body class="bg-gray-100">

<!-- ================= NAVBAR ================= -->
<nav class="bg-gray-800 text-white py-3 px-4 flex items-center justify-between">

    <!-- Logo -->
    <a class="font-bold text-xl tracking-tight" href="{% url 'home' %}">My Site</a>

    <!-- Search -->
    <div class="relative w-full max-w-xl mx-4 hidden md:block">
        <form method="GET" action="{% url 'home' %}">
            <input type="text" name="q"
                   class="w-full h-11 px-4 rounded-full text-gray-800"
                   placeholder="Search...">
        </form>
    </div>

    <!-- Right Side -->
    <div class="flex items-center space-x-4">

        <!-- Cart -->
        <a href="{% url 'cart' %}" class="relative">
            <i class="fas fa-shopping-cart text-xl"></i>
            {% if cart_count %}
            <span class="absolute -top-2 -right-2 w-4 h-4 bg-red-500 text-xs
                         rounded-full flex items-center justify-center">
                {{ cart_count }}
            </span>
            {% endif %}
        </a>

        <!-- Links -->
        <a href="{% url 'home' %}" class="text-sm px-3 py-2 rounded-full hover:bg-gray-700">Home</a>
        <a href="{% url 'about' %}" class="text-sm px-3 py-2 rounded-full hover:bg-gray-700">About</a>
        <a href="{% url 'contact' %}" class="text-sm px-3 py-2 rounded-full hover:bg-gray-700">Contact</a>

       <!-- ========== AUTH SECTION ========== -->
{% if user.is_authenticated %}
<div class="relative">

    <!-- Profile Button -->
    <button id="profileBtn"
        class="flex items-center space-x-2 focus:outline-none">
        <img src="https://ui-avatars.com/api/?name={{ user.username }}&background=0D8ABC&color=fff"
             class="h-9 w-9 rounded-full ring-2 ring-white">
        <span class="hidden md:block text-sm">{{ user.username }}</span>
        <i class="fas fa-chevron-down text-xs"></i>
    </button>

    <!-- Dropdown Menu -->
    <div id="profileMenu"
        class="hidden absolute right-0 mt-2 w-48 bg-white text-gray-800
               rounded-lg shadow-lg z-50">
               {% if user.customer and not user.customer.profile_completed %}
<a href="{% url 'profile' %}"
   class="block px-4 py-2 text-orange-600 hover:bg-orange-50 font-medium">
    <i class="fas fa-exclamation-circle mr-2"></i> Complete Profile
</a>
<div class="border-t"></div>
{% endif %}

       
        <a href="{% url 'profile' %}"
   class="block px-4 py-2 hover:bg-gray-100 font-medium flex items-center space-x-2">
   {% if user.customer.profile_completed %}
      <i class="fas fa-check-circle text-green-600"></i>
      <span>Profile Complete</span>
   {% else %}
      <i class="fas fa-exclamation-circle text-orange-600"></i>
      <span>Complete Profile</span>
   {% endif %}
</a>
<div class="border-t"></div>

       

        <a href="{% url 'profile' %}"
           class="block px-4 py-2 hover:bg-gray-100">
            <i class="fas fa-user mr-2"></i> My Profile
        </a>

        <a href="{% url 'my_orders' %}"
           class="block px-4 py-2 hover:bg-gray-100">
            <i class="fas fa-box mr-2"></i> My Orders
        </a>

        <div class="border-t"></div>

        <form method="POST" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit"
                    class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50">
                <i class="fas fa-sign-out-alt mr-2"></i> Logout
            </button>
        </form>
    </div>
</div>
{% else %}
<a href="{% url 'login' %}"
   class="text-sm px-4 py-2 rounded-full hover:bg-gray-700">
    Login
</a>
{% endif %}

</nav>
<!-- =============== END NAVBAR =============== -->

<main class="p-4">
    {% block content %}{% endblock %}
</main>

<!-- Wishlist JS -->
<script>
document.querySelectorAll('.toggle-wishlist').forEach(item => {
    item.addEventListener('click', function () {
        const productId = this.dataset.product;
        const icon = this.querySelector('i');

        fetch("{% url 'toggle_wishlist' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/x-www-form-urlencoded",
            },
            body: "product_id=" + productId
        })
        .then(res => res.json())
        .then(data => {
            icon.classList.toggle("fa-solid", data.status === "added");
            icon.classList.toggle("fa-regular", data.status !== "added");
        });
    });
});


document.addEventListener("click", function (e) {
    const btn = document.getElementById("profileBtn");
    const menu = document.getElementById("profileMenu");

    if (!btn || !menu) return;

    // Toggle dropdown
    if (btn.contains(e.target)) {
        menu.classList.toggle("hidden");
    } 
    // Click outside â†’ close
    else if (!menu.contains(e.target)) {
        menu.classList.add("hidden");
    }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
